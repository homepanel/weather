package com.homepanel.weather.weather.provider;

import com.homepanel.weather.config.Location;
import com.homepanel.weather.config.OpenWeatherMapLocation;
import com.homepanel.weather.weather.cleaner.GroupDayCleander;
import com.homepanel.weather.weather.data.Current;
import com.homepanel.weather.weather.data.Forecast;
import com.homepanel.weather.weather.parser.JsonWeatherParser;

public class OpenWeatherMapProvider extends Provider<OpenWeatherMapLocation>  {

    private static final String CURRENT = "http://api.openweathermap.org/data/2.5/weather?lat=%s&lon=%s&lang=%s&mode=json&units=%s&appid=%s";
    private static final String FORECAST = "http://api.openweathermap.org/data/2.5/forecast?lat=%s&lon=%s&lang=%s&mode=json&units=%s&appid=%s";

    public OpenWeatherMapProvider() {
        super(new JsonWeatherParser(Provider.TYPE.OPEN_WEATHER_MAP));
    }

    @Override
    public Current executeCurrent(OpenWeatherMapLocation location) throws Exception {

        String content = getUrl(String.format(CURRENT, location.getLatitude(), location.getLongitude(), location.getLanguage(), location.getUnit() == Location.UNIT.METRIC ? "metric" : "imperial", location.getApiKey()));
        //String content = "{\"coord\":{\"lon\":12.6277,\"lat\":48.7802},\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"Bedeckt\",\"icon\":\"04n\"}],\"base\":\"stations\",\"main\":{\"temp\":7.34,\"feels_like\":4.34,\"temp_min\":4.72,\"temp_max\":10.59,\"pressure\":1011,\"humidity\":96},\"visibility\":10000,\"wind\":{\"speed\":4.83,\"deg\":254,\"gust\":10.69},\"clouds\":{\"all\":100},\"dt\":1641225464,\"sys\":{\"type\":2,\"id\":2013220,\"country\":\"DE\",\"sunrise\":1641193345,\"sunset\":1641223502},\"timezone\":3600,\"id\":2859129,\"name\":\"Oberschneiding\",\"cod\":200}";

        if (content != null) {
            Current current = getParser().parseCurrent(content);

            if (current.getResponseCode() == 200) {

                if (location.getTitle() != null) {
                    current.getLocation().setTitle(location.getTitle());
                }

                return current;
            }
        }

        return null;
    }

    @Override
    public Forecast executeForecast(OpenWeatherMapLocation location) throws Exception {

        String content = getUrl(String.format(FORECAST, location.getLatitude(), location.getLongitude(), location.getLanguage(), location.getUnit() == Location.UNIT.METRIC ? "metric" : "imperial", location.getApiKey()));
        //String content = "{\"cod\":\"200\",\"message\":0,\"cnt\":40,\"list\":[{\"dt\":1641232800,\"main\":{\"temp\":7.08,\"feels_like\":4.06,\"temp_min\":7.08,\"temp_max\":8.47,\"pressure\":1010,\"sea_level\":1010,\"grnd_level\":966,\"humidity\":95,\"temp_kf\":-1.39},\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"Leichter Regen\",\"icon\":\"10n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":4.72,\"deg\":250,\"gust\":11.16},\"visibility\":10000,\"pop\":0.59,\"rain\":{\"3h\":0.22},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-03 18:00:00\"},{\"dt\":1641243600,\"main\":{\"temp\":7.54,\"feels_like\":4.62,\"temp_min\":7.54,\"temp_max\":8.45,\"pressure\":1011,\"sea_level\":1011,\"grnd_level\":965,\"humidity\":89,\"temp_kf\":-0.91},\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"Leichter Regen\",\"icon\":\"10n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":4.76,\"deg\":254,\"gust\":10.85},\"visibility\":10000,\"pop\":0.42,\"rain\":{\"3h\":0.17},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-03 21:00:00\"},{\"dt\":1641254400,\"main\":{\"temp\":7.51,\"feels_like\":4.77,\"temp_min\":7.51,\"temp_max\":7.73,\"pressure\":1010,\"sea_level\":1010,\"grnd_level\":962,\"humidity\":90,\"temp_kf\":-0.22},\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"Leichter Regen\",\"icon\":\"10n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":4.35,\"deg\":239,\"gust\":11.46},\"visibility\":9967,\"pop\":0.99,\"rain\":{\"3h\":1.37},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-04 00:00:00\"},{\"dt\":1641265200,\"main\":{\"temp\":8.01,\"feels_like\":5.39,\"temp_min\":8.01,\"temp_max\":8.01,\"pressure\":1007,\"sea_level\":1007,\"grnd_level\":959,\"humidity\":92,\"temp_kf\":0},\"weather\":[{\"id\":501,\"main\":\"Rain\",\"description\":\"Mäßiger Regen\",\"icon\":\"10n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":4.35,\"deg\":223,\"gust\":10.89},\"visibility\":10000,\"pop\":1,\"rain\":{\"3h\":3.03},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-04 03:00:00\"},{\"dt\":1641276000,\"main\":{\"temp\":8.11,\"feels_like\":4.85,\"temp_min\":8.11,\"temp_max\":8.11,\"pressure\":1004,\"sea_level\":1004,\"grnd_level\":957,\"humidity\":89,\"temp_kf\":0},\"weather\":[{\"id\":501,\"main\":\"Rain\",\"description\":\"Mäßiger Regen\",\"icon\":\"10n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":5.97,\"deg\":219,\"gust\":14.87},\"visibility\":10000,\"pop\":1,\"rain\":{\"3h\":3.65},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-04 06:00:00\"},{\"dt\":1641286800,\"main\":{\"temp\":8.31,\"feels_like\":6.01,\"temp_min\":8.31,\"temp_max\":8.31,\"pressure\":1002,\"sea_level\":1002,\"grnd_level\":955,\"humidity\":88,\"temp_kf\":0},\"weather\":[{\"id\":501,\"main\":\"Rain\",\"description\":\"Mäßiger Regen\",\"icon\":\"10d\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":3.83,\"deg\":227,\"gust\":12.34},\"visibility\":10000,\"pop\":1,\"rain\":{\"3h\":3.41},\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-04 09:00:00\"},{\"dt\":1641297600,\"main\":{\"temp\":11.85,\"feels_like\":11.07,\"temp_min\":11.85,\"temp_max\":11.85,\"pressure\":998,\"sea_level\":998,\"grnd_level\":952,\"humidity\":76,\"temp_kf\":0},\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"Leichter Regen\",\"icon\":\"10d\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":9.78,\"deg\":246,\"gust\":21.12},\"visibility\":10000,\"pop\":1,\"rain\":{\"3h\":1.71},\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-04 12:00:00\"},{\"dt\":1641308400,\"main\":{\"temp\":12.01,\"feels_like\":11.28,\"temp_min\":12.01,\"temp_max\":12.01,\"pressure\":997,\"sea_level\":997,\"grnd_level\":951,\"humidity\":77,\"temp_kf\":0},\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"Leichter Regen\",\"icon\":\"10d\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":8.77,\"deg\":250,\"gust\":20.38},\"visibility\":10000,\"pop\":0.78,\"rain\":{\"3h\":0.44},\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-04 15:00:00\"},{\"dt\":1641319200,\"main\":{\"temp\":7.94,\"feels_like\":4.78,\"temp_min\":7.94,\"temp_max\":7.94,\"pressure\":1000,\"sea_level\":1000,\"grnd_level\":953,\"humidity\":85,\"temp_kf\":0},\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"Leichter Regen\",\"icon\":\"10n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":5.59,\"deg\":310,\"gust\":11.46},\"visibility\":10000,\"pop\":1,\"rain\":{\"3h\":0.51},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-04 18:00:00\"},{\"dt\":1641330000,\"main\":{\"temp\":5.26,\"feels_like\":2.1,\"temp_min\":5.26,\"temp_max\":5.26,\"pressure\":1002,\"sea_level\":1002,\"grnd_level\":954,\"humidity\":89,\"temp_kf\":0},\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"Leichter Regen\",\"icon\":\"10n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":4.14,\"deg\":317,\"gust\":6.49},\"visibility\":10000,\"pop\":0.91,\"rain\":{\"3h\":0.79},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-04 21:00:00\"},{\"dt\":1641340800,\"main\":{\"temp\":3.98,\"feels_like\":2.38,\"temp_min\":3.98,\"temp_max\":3.98,\"pressure\":1002,\"sea_level\":1002,\"grnd_level\":954,\"humidity\":93,\"temp_kf\":0},\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"Leichter Regen\",\"icon\":\"10n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":1.82,\"deg\":306,\"gust\":2.39},\"visibility\":10000,\"pop\":0.98,\"rain\":{\"3h\":0.78},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-05 00:00:00\"},{\"dt\":1641351600,\"main\":{\"temp\":3.09,\"feels_like\":0.15,\"temp_min\":3.09,\"temp_max\":3.09,\"pressure\":1002,\"sea_level\":1002,\"grnd_level\":954,\"humidity\":96,\"temp_kf\":0},\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"Leichter Regen\",\"icon\":\"10n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":3.08,\"deg\":300,\"gust\":4.41},\"visibility\":238,\"pop\":0.93,\"rain\":{\"3h\":1.59},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-05 03:00:00\"},{\"dt\":1641362400,\"main\":{\"temp\":2.19,\"feels_like\":-1.3,\"temp_min\":2.19,\"temp_max\":2.19,\"pressure\":1004,\"sea_level\":1004,\"grnd_level\":956,\"humidity\":97,\"temp_kf\":0},\"weather\":[{\"id\":601,\"main\":\"Snow\",\"description\":\"Schnee\",\"icon\":\"13n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":3.57,\"deg\":271,\"gust\":7.2},\"visibility\":85,\"pop\":1,\"snow\":{\"3h\":3.15},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-05 06:00:00\"},{\"dt\":1641373200,\"main\":{\"temp\":2.18,\"feels_like\":-1.58,\"temp_min\":2.18,\"temp_max\":2.18,\"pressure\":1007,\"sea_level\":1007,\"grnd_level\":958,\"humidity\":99,\"temp_kf\":0},\"weather\":[{\"id\":601,\"main\":\"Snow\",\"description\":\"Schnee\",\"icon\":\"13d\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":3.96,\"deg\":254,\"gust\":10.15},\"visibility\":28,\"pop\":1,\"snow\":{\"3h\":2.84},\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-05 09:00:00\"},{\"dt\":1641384000,\"main\":{\"temp\":2.32,\"feels_like\":-2.13,\"temp_min\":2.32,\"temp_max\":2.32,\"pressure\":1009,\"sea_level\":1009,\"grnd_level\":961,\"humidity\":83,\"temp_kf\":0},\"weather\":[{\"id\":600,\"main\":\"Snow\",\"description\":\"Mäßiger Schnee\",\"icon\":\"13d\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":5.22,\"deg\":303,\"gust\":9.12},\"visibility\":10000,\"pop\":1,\"snow\":{\"3h\":0.82},\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-05 12:00:00\"},{\"dt\":1641394800,\"main\":{\"temp\":1.77,\"feels_like\":-3.3,\"temp_min\":1.77,\"temp_max\":1.77,\"pressure\":1012,\"sea_level\":1012,\"grnd_level\":963,\"humidity\":74,\"temp_kf\":0},\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"Bedeckt\",\"icon\":\"04d\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":6.21,\"deg\":274,\"gust\":10.51},\"visibility\":10000,\"pop\":0.16,\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-05 15:00:00\"},{\"dt\":1641405600,\"main\":{\"temp\":0.55,\"feels_like\":-4.88,\"temp_min\":0.55,\"temp_max\":0.55,\"pressure\":1015,\"sea_level\":1015,\"grnd_level\":966,\"humidity\":76,\"temp_kf\":0},\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"Bedeckt\",\"icon\":\"04n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":6.27,\"deg\":264,\"gust\":12.55},\"visibility\":10000,\"pop\":0.09,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-05 18:00:00\"},{\"dt\":1641416400,\"main\":{\"temp\":0.32,\"feels_like\":-5.15,\"temp_min\":0.32,\"temp_max\":0.32,\"pressure\":1017,\"sea_level\":1017,\"grnd_level\":967,\"humidity\":82,\"temp_kf\":0},\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"Bedeckt\",\"icon\":\"04n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":6.21,\"deg\":262,\"gust\":12.14},\"visibility\":10000,\"pop\":0.32,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-05 21:00:00\"},{\"dt\":1641427200,\"main\":{\"temp\":-0.23,\"feels_like\":-5.39,\"temp_min\":-0.23,\"temp_max\":-0.23,\"pressure\":1018,\"sea_level\":1018,\"grnd_level\":968,\"humidity\":94,\"temp_kf\":0},\"weather\":[{\"id\":600,\"main\":\"Snow\",\"description\":\"Mäßiger Schnee\",\"icon\":\"13n\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":5.33,\"deg\":257,\"gust\":10.45},\"visibility\":497,\"pop\":0.55,\"snow\":{\"3h\":0.44},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-06 00:00:00\"},{\"dt\":1641438000,\"main\":{\"temp\":-0.2,\"feels_like\":-5.35,\"temp_min\":-0.2,\"temp_max\":-0.2,\"pressure\":1018,\"sea_level\":1018,\"grnd_level\":969,\"humidity\":94,\"temp_kf\":0},\"weather\":[{\"id\":600,\"main\":\"Snow\",\"description\":\"Mäßiger Schnee\",\"icon\":\"13n\"}],\"clouds\":{\"all\":97},\"wind\":{\"speed\":5.32,\"deg\":270,\"gust\":10.13},\"visibility\":4746,\"pop\":0.88,\"snow\":{\"3h\":0.45},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-06 03:00:00\"},{\"dt\":1641448800,\"main\":{\"temp\":-0.47,\"feels_like\":-5.02,\"temp_min\":-0.47,\"temp_max\":-0.47,\"pressure\":1020,\"sea_level\":1020,\"grnd_level\":971,\"humidity\":94,\"temp_kf\":0},\"weather\":[{\"id\":600,\"main\":\"Snow\",\"description\":\"Mäßiger Schnee\",\"icon\":\"13n\"}],\"clouds\":{\"all\":87},\"wind\":{\"speed\":4.23,\"deg\":276,\"gust\":8.49},\"visibility\":10000,\"pop\":0.62,\"snow\":{\"3h\":0.14},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-06 06:00:00\"},{\"dt\":1641459600,\"main\":{\"temp\":0.42,\"feels_like\":-3.93,\"temp_min\":0.42,\"temp_max\":0.42,\"pressure\":1022,\"sea_level\":1022,\"grnd_level\":973,\"humidity\":84,\"temp_kf\":0},\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"Mäßig bewölkt\",\"icon\":\"03d\"}],\"clouds\":{\"all\":40},\"wind\":{\"speed\":4.24,\"deg\":282,\"gust\":8.32},\"visibility\":10000,\"pop\":0.02,\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-06 09:00:00\"},{\"dt\":1641470400,\"main\":{\"temp\":2.38,\"feels_like\":-1.62,\"temp_min\":2.38,\"temp_max\":2.38,\"pressure\":1022,\"sea_level\":1022,\"grnd_level\":973,\"humidity\":69,\"temp_kf\":0},\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"Mäßig bewölkt\",\"icon\":\"03d\"}],\"clouds\":{\"all\":32},\"wind\":{\"speed\":4.42,\"deg\":300,\"gust\":5.87},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-06 12:00:00\"},{\"dt\":1641481200,\"main\":{\"temp\":0.91,\"feels_like\":-1.73,\"temp_min\":0.91,\"temp_max\":0.91,\"pressure\":1023,\"sea_level\":1023,\"grnd_level\":974,\"humidity\":79,\"temp_kf\":0},\"weather\":[{\"id\":600,\"main\":\"Snow\",\"description\":\"Mäßiger Schnee\",\"icon\":\"13d\"}],\"clouds\":{\"all\":70},\"wind\":{\"speed\":2.29,\"deg\":295,\"gust\":3.25},\"visibility\":10000,\"pop\":0.32,\"snow\":{\"3h\":0.25},\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-06 15:00:00\"},{\"dt\":1641492000,\"main\":{\"temp\":-0.58,\"feels_like\":-0.58,\"temp_min\":-0.58,\"temp_max\":-0.58,\"pressure\":1025,\"sea_level\":1025,\"grnd_level\":975,\"humidity\":86,\"temp_kf\":0},\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"Überwiegend bewölkt\",\"icon\":\"04n\"}],\"clouds\":{\"all\":57},\"wind\":{\"speed\":1.17,\"deg\":325,\"gust\":1.28},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-06 18:00:00\"},{\"dt\":1641502800,\"main\":{\"temp\":-0.92,\"feels_like\":-0.92,\"temp_min\":-0.92,\"temp_max\":-0.92,\"pressure\":1026,\"sea_level\":1026,\"grnd_level\":976,\"humidity\":85,\"temp_kf\":0},\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"Überwiegend bewölkt\",\"icon\":\"04n\"}],\"clouds\":{\"all\":51},\"wind\":{\"speed\":1.15,\"deg\":22,\"gust\":1.18},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-06 21:00:00\"},{\"dt\":1641513600,\"main\":{\"temp\":-1.89,\"feels_like\":-4.44,\"temp_min\":-1.89,\"temp_max\":-1.89,\"pressure\":1025,\"sea_level\":1025,\"grnd_level\":975,\"humidity\":87,\"temp_kf\":0},\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"Mäßig bewölkt\",\"icon\":\"03n\"}],\"clouds\":{\"all\":32},\"wind\":{\"speed\":1.84,\"deg\":123,\"gust\":2.21},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-07 00:00:00\"},{\"dt\":1641524400,\"main\":{\"temp\":-2.45,\"feels_like\":-5.28,\"temp_min\":-2.45,\"temp_max\":-2.45,\"pressure\":1024,\"sea_level\":1024,\"grnd_level\":974,\"humidity\":90,\"temp_kf\":0},\"weather\":[{\"id\":800,\"main\":\"Clear\",\"description\":\"Klarer Himmel\",\"icon\":\"01n\"}],\"clouds\":{\"all\":10},\"wind\":{\"speed\":1.98,\"deg\":100,\"gust\":3.37},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-07 03:00:00\"},{\"dt\":1641535200,\"main\":{\"temp\":-2.47,\"feels_like\":-4.34,\"temp_min\":-2.47,\"temp_max\":-2.47,\"pressure\":1023,\"sea_level\":1023,\"grnd_level\":973,\"humidity\":91,\"temp_kf\":0},\"weather\":[{\"id\":802,\"main\":\"Clouds\",\"description\":\"Mäßig bewölkt\",\"icon\":\"03n\"}],\"clouds\":{\"all\":38},\"wind\":{\"speed\":1.37,\"deg\":100,\"gust\":2.68},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-07 06:00:00\"},{\"dt\":1641546000,\"main\":{\"temp\":-1.08,\"feels_like\":-1.08,\"temp_min\":-1.08,\"temp_max\":-1.08,\"pressure\":1023,\"sea_level\":1023,\"grnd_level\":973,\"humidity\":83,\"temp_kf\":0},\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"Bedeckt\",\"icon\":\"04d\"}],\"clouds\":{\"all\":95},\"wind\":{\"speed\":1.19,\"deg\":125,\"gust\":2.04},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-07 09:00:00\"},{\"dt\":1641556800,\"main\":{\"temp\":0.4,\"feels_like\":-2.26,\"temp_min\":0.4,\"temp_max\":0.4,\"pressure\":1022,\"sea_level\":1022,\"grnd_level\":972,\"humidity\":71,\"temp_kf\":0},\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"Bedeckt\",\"icon\":\"04d\"}],\"clouds\":{\"all\":97},\"wind\":{\"speed\":2.23,\"deg\":146,\"gust\":2.93},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-07 12:00:00\"},{\"dt\":1641567600,\"main\":{\"temp\":-0.68,\"feels_like\":-2.29,\"temp_min\":-0.68,\"temp_max\":-0.68,\"pressure\":1021,\"sea_level\":1021,\"grnd_level\":971,\"humidity\":77,\"temp_kf\":0},\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"Bedeckt\",\"icon\":\"04d\"}],\"clouds\":{\"all\":97},\"wind\":{\"speed\":1.36,\"deg\":177,\"gust\":1.45},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-07 15:00:00\"},{\"dt\":1641578400,\"main\":{\"temp\":-2.39,\"feels_like\":-4.55,\"temp_min\":-2.39,\"temp_max\":-2.39,\"pressure\":1022,\"sea_level\":1022,\"grnd_level\":972,\"humidity\":84,\"temp_kf\":0},\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"Überwiegend bewölkt\",\"icon\":\"04n\"}],\"clouds\":{\"all\":63},\"wind\":{\"speed\":1.54,\"deg\":206,\"gust\":1.81},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-07 18:00:00\"},{\"dt\":1641589200,\"main\":{\"temp\":-2.79,\"feels_like\":-4.64,\"temp_min\":-2.79,\"temp_max\":-2.79,\"pressure\":1022,\"sea_level\":1022,\"grnd_level\":972,\"humidity\":86,\"temp_kf\":0},\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"Ein paar Wolken\",\"icon\":\"02n\"}],\"clouds\":{\"all\":11},\"wind\":{\"speed\":1.34,\"deg\":209,\"gust\":1.68},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-07 21:00:00\"},{\"dt\":1641600000,\"main\":{\"temp\":-3.24,\"feels_like\":-3.24,\"temp_min\":-3.24,\"temp_max\":-3.24,\"pressure\":1023,\"sea_level\":1023,\"grnd_level\":973,\"humidity\":88,\"temp_kf\":0},\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"Ein paar Wolken\",\"icon\":\"02n\"}],\"clouds\":{\"all\":12},\"wind\":{\"speed\":1.23,\"deg\":195,\"gust\":1.64},\"visibility\":10000,\"pop\":0,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-08 00:00:00\"},{\"dt\":1641610800,\"main\":{\"temp\":-3.1,\"feels_like\":-3.1,\"temp_min\":-3.1,\"temp_max\":-3.1,\"pressure\":1024,\"sea_level\":1024,\"grnd_level\":973,\"humidity\":85,\"temp_kf\":0},\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"Bedeckt\",\"icon\":\"04n\"}],\"clouds\":{\"all\":97},\"wind\":{\"speed\":1.18,\"deg\":183,\"gust\":2.33},\"visibility\":10000,\"pop\":0.01,\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-08 03:00:00\"},{\"dt\":1641621600,\"main\":{\"temp\":-2.85,\"feels_like\":-4.75,\"temp_min\":-2.85,\"temp_max\":-2.85,\"pressure\":1025,\"sea_level\":1025,\"grnd_level\":974,\"humidity\":93,\"temp_kf\":0},\"weather\":[{\"id\":600,\"main\":\"Snow\",\"description\":\"Mäßiger Schnee\",\"icon\":\"13n\"}],\"clouds\":{\"all\":98},\"wind\":{\"speed\":1.36,\"deg\":199,\"gust\":2.88},\"visibility\":604,\"pop\":0.27,\"snow\":{\"3h\":0.13},\"sys\":{\"pod\":\"n\"},\"dt_txt\":\"2022-01-08 06:00:00\"},{\"dt\":1641632400,\"main\":{\"temp\":-1.05,\"feels_like\":-3.49,\"temp_min\":-1.05,\"temp_max\":-1.05,\"pressure\":1026,\"sea_level\":1026,\"grnd_level\":976,\"humidity\":92,\"temp_kf\":0},\"weather\":[{\"id\":600,\"main\":\"Snow\",\"description\":\"Mäßiger Schnee\",\"icon\":\"13d\"}],\"clouds\":{\"all\":99},\"wind\":{\"speed\":1.86,\"deg\":222,\"gust\":4.81},\"visibility\":706,\"pop\":0.33,\"snow\":{\"3h\":0.36},\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-08 09:00:00\"},{\"dt\":1641643200,\"main\":{\"temp\":0.3,\"feels_like\":-2.25,\"temp_min\":0.3,\"temp_max\":0.3,\"pressure\":1025,\"sea_level\":1025,\"grnd_level\":975,\"humidity\":91,\"temp_kf\":0},\"weather\":[{\"id\":600,\"main\":\"Snow\",\"description\":\"Mäßiger Schnee\",\"icon\":\"13d\"}],\"clouds\":{\"all\":100},\"wind\":{\"speed\":2.12,\"deg\":249,\"gust\":5.33},\"visibility\":10000,\"pop\":0.31,\"snow\":{\"3h\":0.26},\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-08 12:00:00\"},{\"dt\":1641654000,\"main\":{\"temp\":0.57,\"feels_like\":-1.88,\"temp_min\":0.57,\"temp_max\":0.57,\"pressure\":1023,\"sea_level\":1023,\"grnd_level\":974,\"humidity\":88,\"temp_kf\":0},\"weather\":[{\"id\":804,\"main\":\"Clouds\",\"description\":\"Bedeckt\",\"icon\":\"04d\"}],\"clouds\":{\"all\":99},\"wind\":{\"speed\":2.07,\"deg\":212,\"gust\":3.64},\"visibility\":10000,\"pop\":0.13,\"sys\":{\"pod\":\"d\"},\"dt_txt\":\"2022-01-08 15:00:00\"}],\"city\":{\"id\":2859129,\"name\":\"Oberschneiding\",\"coord\":{\"lat\":48.7802,\"lon\":12.6277},\"country\":\"DE\",\"population\":2745,\"timezone\":3600,\"sunrise\":1641193345,\"sunset\":1641223502}}";
        if (content != null) {
            Forecast forecast = getParser().parseForecast(content, new GroupDayCleander());

            if (forecast.getResponseCode() == 200) {

                if (location.getTitle() != null) {
                    forecast.getLocation().setTitle(location.getTitle());
                }

                return forecast;
            }
        }

        return null;
    }
}